<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YHStudio | 服务状态监控</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.6.6/css/flag-icons.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --bg-color: rgba(255, 255, 255, 0.25);
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.25);
            --border-radius: 16px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .dark-theme {
            --bg-color: rgba(30, 30, 30, 0.25);
            --text-color: #f5f5f5;
            --card-bg: rgba(40, 40, 40, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            animation: bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card h3 {
            margin-bottom: 10px;
            font-size: 1rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .status-section {
            margin-bottom: 40px;
        }

        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
            animation: slideInLeft 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .server-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            animation: bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .server-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .server-name {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .server-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-up {
            background-color: var(--success-color);
            color: white;
        }

        .status-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .status-down {
            background-color: var(--danger-color);
            color: white;
        }

        .server-details {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .website-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            animation: bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .website-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .website-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
            text-decoration: underline;
        }

        .flag-icon {
            margin-right: 8px;
            font-size: 1.5rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }

        .error {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--danger-color);
        }

        /* 动画定义 */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .server-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .theme-switch {
                align-self: flex-end;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-value {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="container">
        <header>
            <h1>YHStudio | 服务状态监控</h1>
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </header>
        
        <section class="stats-grid">
            <div class="stat-card">
                <h3>总监控数</h3>
                <div class="stat-value" id="total-monitors">0</div>
                <p>监控点总数</p>
            </div>
            <div class="stat-card">
                <h3>正常运行</h3>
                <div class="stat-value" id="up-monitors">0</div>
                <p>服务正常</p>
            </div>
            <div class="stat-card">
                <h3>可能异常</h3>
                <div class="stat-value" id="warning-monitors">0</div>
                <p>需要关注</p>
            </div>
            <div class="stat-card">
                <h3>故障</h3>
                <div class="stat-value" id="down-monitors">0</div>
                <p>服务中断</p>
            </div>
            <div class="stat-card">
                <h3>平均正常运行率</h3>
                <div class="stat-value" id="avg-uptime">0%</div>
                <p>整体可用性</p>
            </div>
        </section>
        
        <section class="status-section">
            <h2 class="section-title">服务器状态</h2>
            <div class="server-grid" id="server-list">
                <div class="loading">正在加载服务器状态...</div>
            </div>
        </section>
        
        <section class="status-section">
            <h2 class="section-title">网站监控</h2>
            <div class="server-grid" id="website-list">
                <div class="loading">正在加载网站状态...</div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // 配置UptimeRobot API密钥
        const API_KEY = 'ur3008252-3391970337016d08ad3db5de';
        const API_URL = 'https://api.uptimerobot.com/v2/getMonitors';
        
        // 初始化粒子背景
        document.addEventListener('DOMContentLoaded', function() {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ffffff",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                },
                retina_detect: true
            });
            
            // 主题切换
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('change', function() {
                document.body.classList.toggle('dark-theme');
            });
            
            // 加载真实API数据
            loadRealStatusData();
            
            // 添加Intersection Observer以在元素进入视图时触发动画
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);
            
            // 观察所有卡片元素
            document.querySelectorAll('.stat-card, .server-card, .website-card').forEach(card => {
                observer.observe(card);
            });
        });
        
        // 从UptimeRobot API获取真实数据
        async function loadRealStatusData() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'cache-control': 'no-cache'
                    },
                    body: `api_key=${API_KEY}&format=json&logs=1`
                });
                
                if (!response.ok) {
                    throw new Error('网络响应不正常');
                }
                
                const data = await response.json();
                
                if (data.stat === 'ok') {
                    processMonitorData(data.monitors);
                } else {
                    throw new Error('API返回错误: ' + data.message);
                }
            } catch (error) {
                console.error('获取监控数据时出错:', error);
                document.getElementById('server-list').innerHTML = '<div class="error">加载监控数据失败，请检查API密钥和网络连接</div>';
                document.getElementById('website-list').innerHTML = '<div class="error">加载监控数据失败，请检查API密钥和网络连接</div>';
            }
        }
        
        // 处理监控数据
        function processMonitorData(monitors) {
            // 统计数据
            const totalMonitors = monitors.length;
            const upMonitors = monitors.filter(m => m.status === 2).length;
            const warningMonitors = monitors.filter(m => m.status === 8 || m.status === 9).length;
            const downMonitors = monitors.filter(m => m.status === 0 || m.status === 1).length;
            
            // 计算平均正常运行率
            const avgUptime = monitors.reduce((sum, m) => sum + parseFloat(m.custom_uptime_ratio || '0'), 0) / monitors.length;
            
            // 更新统计数据
            animateValue('total-monitors', 0, totalMonitors, 1500);
            animateValue('up-monitors', 0, upMonitors, 1500);
            animateValue('warning-monitors', 0, warningMonitors, 1500);
            animateValue('down-monitors', 0, downMonitors, 1500);
            animateValue('avg-uptime', 0, avgUptime, 1500, true);
            
            // 分离服务器和网站监控
            const servers = monitors.filter(m => m.type !== 1 && m.type !== 2); // 非HTTP/HTTPS监控
            const websites = monitors.filter(m => m.type === 1 || m.type === 2); // HTTP/HTTPS监控
            
            // 渲染服务器列表
            renderServerList(servers);
            
            // 渲染网站列表
            renderWebsiteList(websites);
        }
        
        // 渲染服务器列表
        function renderServerList(servers) {
            const serverList = document.getElementById('server-list');
            
            if (servers.length === 0) {
                serverList.innerHTML = '<div class="error">没有找到服务器监控数据</div>';
                return;
            }
            
            serverList.innerHTML = '';
            
            servers.forEach(server => {
                const serverCard = document.createElement('div');
                serverCard.className = 'server-card';
                
                // 确定服务器状态
                let statusText, statusClass;
                if (server.status === 2) {
                    statusText = '正常运行';
                    statusClass = 'status-up';
                } else if (server.status === 8 || server.status === 9) {
                    statusText = '可能异常';
                    statusClass = 'status-warning';
                } else {
                    statusText = '故障';
                    statusClass = 'status-down';
                }
                
                // 确定服务器地区并设置对应国旗
                const flagClass = getFlagClass(server.friendly_name);
                
                serverCard.innerHTML = `
                    <div class="server-header">
                        <div class="server-name">
                            <span class="flag-icon ${flagClass}"></span>
                            ${server.friendly_name}
                        </div>
                        <div class="server-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="server-details">
                        <div>延迟: <strong>${server.response_times ? server.response_times[0].value + 'ms' : 'N/A'}</strong></div>
                        <div>正常运行率: <strong>${server.custom_uptime_ratio || 'N/A'}%</strong></div>
                    </div>
                `;
                
                serverList.appendChild(serverCard);
            });
        }
        
        // 渲染网站列表
        function renderWebsiteList(websites) {
            const websiteList = document.getElementById('website-list');
            
            if (websites.length === 0) {
                websiteList.innerHTML = '<div class="error">没有找到网站监控数据</div>';
                return;
            }
            
            websiteList.innerHTML = '';
            
            websites.forEach(website => {
                const websiteCard = document.createElement('div');
                websiteCard.className = 'website-card';
                
                // 确定网站状态
                let statusText, statusClass;
                if (website.status === 2) {
                    statusText = '正常运行';
                    statusClass = 'status-up';
                } else if (website.status === 8 || website.status === 9) {
                    statusText = '可能异常';
                    statusClass = 'status-warning';
                } else {
                    statusText = '故障';
                    statusClass = 'status-down';
                }
                
                // 确定网站地区并设置对应国旗
                const flagClass = getFlagClass(website.friendly_name);
                
                websiteCard.innerHTML = `
                    <div class="server-header">
                        <div class="website-name" data-url="${website.url}">
                            <span class="flag-icon ${flagClass}"></span>
                            ${website.friendly_name}
                        </div>
                        <div class="server-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="server-details">
                        <div>延迟: <strong>${website.response_times ? website.response_times[0].value + 'ms' : 'N/A'}</strong></div>
                        <div>正常运行率: <strong>${website.custom_uptime_ratio || 'N/A'}%</strong></div>
                    </div>
                `;
                
                // 添加点击事件以在新窗口中打开网站
                websiteCard.querySelector('.website-name').addEventListener('click', function() {
                    window.open(this.getAttribute('data-url'), '_blank');
                });
                
                websiteList.appendChild(websiteCard);
            });
        }
        
        // 根据名称获取国旗类
        function getFlagClass(name) {
            if (!name) return 'fi fi-global';
            
            const lowerName = name.toLowerCase();
            
            if (lowerName.includes('中国') || lowerName.includes('北京') || lowerName.includes('上海') || 
                lowerName.includes('深圳') || lowerName.includes('广州')) {
                return 'fi fi-cn';
            } else if (lowerName.includes('香港')) {
                return 'fi fi-hk';
            } else if (lowerName.includes('台湾') || lowerName.includes('台北')) {
                return 'fi fi-tw';
            } else if (lowerName.includes('澳门')) {
                return 'fi fi-mo';
            } else if (lowerName.includes('美国') || lowerName.includes('美东') || lowerName.includes('美西')) {
                return 'fi fi-us';
            } else if (lowerName.includes('英国') || lowerName.includes('伦敦')) {
                return 'fi fi-gb';
            } else if (lowerName.includes('日本') || lowerName.includes('东京')) {
                return 'fi fi-jp';
            } else if (lowerName.includes('德国') || lowerName.includes('法兰克福')) {
                return 'fi fi-de';
            } else if (lowerName.includes('法国') || lowerName.includes('巴黎')) {
                return 'fi fi-fr';
            } else if (lowerName.includes('加拿大')) {
                return 'fi fi-ca';
            } else if (lowerName.includes('澳大利亚') || lowerName.includes('悉尼')) {
                return 'fi fi-au';
            } else if (lowerName.includes('新加坡')) {
                return 'fi fi-sg';
            } else if (lowerName.includes('韩国') || lowerName.includes('首尔')) {
                return 'fi fi-kr';
            } else {
                return 'fi fi-global';
            }
        }
        
        // 数字动画函数
        function animateValue(id, start, end, duration, isPercentage = false) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                obj.innerHTML = isPercentage ? value.toFixed(1) + "%" : value;
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>